<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Sontak</title>
    <style>
        /* --- ESTILO GERAL (Modo Escuro / Futurista) --- */
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            text-align: center; 
            background-color: #121212; 
            color: #e0e0e0; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            overflow-x: hidden; 
        }
        
        /* --- TELA DE LOGIN --- */
        #loginScreen { 
            width: 100%; 
            max-width: 320px; 
            padding: 20px; 
            animation: fadeIn 1s ease-in; 
        }
        .sontak-title { 
            color: #bb86fc; 
            font-size: 1.8rem; 
            letter-spacing: 3px; 
            margin-bottom: 5px; 
            text-transform: uppercase; 
            font-weight: 800;
        }
        .sontak-sub { 
            color: #888; 
            font-size: 0.9rem; 
            margin-bottom: 30px; 
        }
        
        /* Display da Senha */
        .pin-display { 
            background: #1e1e1e; 
            border: 2px solid #333; 
            height: 60px; 
            border-radius: 12px; 
            margin-bottom: 25px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 2rem; 
            letter-spacing: 15px; 
            color: #03dac6;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.7);
        }

        /* Teclado Num√©rico Customizado */
        .keypad { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
        }
        .key { 
            background: #2c2c2c; 
            color: #fff; 
            border: none; 
            padding: 20px 0; 
            font-size: 1.5rem; 
            border-radius: 50%; 
            cursor: pointer; 
            transition: all 0.1s; 
            box-shadow: 0 4px 5px rgba(0,0,0,0.3); 
            outline: none; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent; /* Remove flash azul no mobile */
            aspect-ratio: 1; /* Mant√©m o bot√£o redondo */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .key:active { 
            background: #bb86fc; 
            color: #000; 
            transform: scale(0.92); 
        }
        .key-clear { 
            background: #3a1c1c; 
            color: #ff5555; 
            font-size: 1.2rem; 
        }
        .key-enter { 
            background: #03dac6; 
            color: #000; 
            font-size: 1.2rem; 
            font-weight: bold;
        }

        /* --- TELA PRINCIPAL DO APP (Inicia Oculta) --- */
        #appContainer { 
            display: none; 
            width: 90%; 
            max-width: 400px; 
            background: #1e1e1e; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            animation: slideUp 0.6s ease-out; 
        }
        
        .level-circle { 
            width: 110px; 
            height: 110px; 
            background: #bb86fc; 
            color: #000; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 3rem; 
            font-weight: bold; 
            margin: 0 auto; 
            box-shadow: 0 0 20px rgba(187, 134, 252, 0.4); 
        }
        
        .xp-bar-bg { 
            width: 100%; 
            background: #333; 
            height: 35px; 
            border-radius: 20px; 
            margin: 20px 0; 
            overflow: hidden; 
            position: relative; 
            border: 2px solid #444; 
        }
        .xp-bar-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #03dac6, #018786); 
            width: 0%; 
            transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); 
        }
        .xp-text { 
            position: absolute; 
            width: 100%; 
            text-align: center; 
            line-height: 35px; 
            font-size: 0.95rem; 
            color: #fff; 
            font-weight: bold; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8); 
            top: 0; 
            left: 0; 
        }
        
        input.app-input { 
            padding: 15px; 
            border-radius: 10px; 
            border: 1px solid #444; 
            background: #2c2c2c; 
            color: white; 
            width: 70%; 
            text-align: center; 
            font-size: 1.2rem; 
            margin-bottom: 15px; 
            outline: none;
        }
        input.app-input:focus {
            border-color: #bb86fc;
        }

        button.app-btn { 
            background: #03dac6; 
            color: #000; 
            border: none; 
            padding: 15px 30px; 
            font-size: 1.1rem; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            width: 100%; 
            transition: 0.2s; 
            text-transform: uppercase;
        }
        button.app-btn:active { 
            transform: scale(0.96); 
            background: #018786; 
        }
        
        .log { 
            margin-top: 25px; 
            font-size: 0.85rem; 
            color: #666; 
            text-align: center; 
        }

        /* --- ANIMA√á√ïES --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes shake { 
            0% { transform: translateX(0); } 
            25% { transform: translateX(-10px); } 
            50% { transform: translateX(10px); } 
            75% { transform: translateX(-10px); } 
            100% { transform: translateX(0); } 
        }
        .error-shake { 
            animation: shake 0.4s; 
            border-color: #ff5555 !important; 
            color: #ff5555 !important; 
        }

    </style>
</head>
<body>

    <div id="loginScreen">
        <h1 class="sontak-title">Ol√° SONTAK</h1>
        <p class="sontak-sub">Logue para acessar o seu sistema</p>
        
        <div id="pinDisplay" class="pin-display"></div>
        
        <div class="keypad">
            <button class="key" onclick="pressKey(1)">1</button>
            <button class="key" onclick="pressKey(2)">2</button>
            <button class="key" onclick="pressKey(3)">3</button>
            <button class="key" onclick="pressKey(4)">4</button>
            <button class="key" onclick="pressKey(5)">5</button>
            <button class="key" onclick="pressKey(6)">6</button>
            <button class="key" onclick="pressKey(7)">7</button>
            <button class="key" onclick="pressKey(8)">8</button>
            <button class="key" onclick="pressKey(9)">9</button>
            <button class="key key-clear" onclick="clearPin()">C</button>
            <button class="key" onclick="pressKey(0)">0</button>
            <button class="key key-enter" onclick="checkPin()">GO</button>
        </div>
    </div>

    <div id="appContainer">
        <h1 style="color: #bb86fc; margin-top:0;">Ficha do V√≠tor</h1>
        
        <div class="level-circle" id="levelDisplay">-</div>
        <p style="color: #888; margin-top: 10px; font-weight: 500;">N√çVEL ATUAL</p>

        <div class="xp-bar-bg">
            <div id="xpBar" class="xp-bar-fill"></div>
            <div class="xp-text"><span id="xpDisplay">0</span> / <span id="nextLevelDisplay">...</span> XP</div>
        </div>

        <input type="number" id="xpInput" class="app-input" placeholder="Digite o XP ganho">
        <button class="app-btn" onclick="addXP()">Confirmar</button>

        <div class="log" id="statusMsg">Aguardando sincroniza√ß√£o...</div>
    </div>

<script type="module">
  // ------------------------------------------------------------------
  // PARTE 1: L√ìGICA DO TECLADO E LOGIN (Sem Firebase ainda)
  // ------------------------------------------------------------------
  
  let currentPin = "";
  const correctPin = "010118"; // A SENHA QUE VOC√ä ESCOLHEU
  
  // Fun√ß√£o para digitar n√∫meros
  window.pressKey = function(num) {
      if(currentPin.length < 6) {
          currentPin += num;
          updateDisplay();
      }
  };

  // Fun√ß√£o para limpar
  window.clearPin = function() {
      currentPin = "";
      updateDisplay();
      document.getElementById("pinDisplay").classList.remove("error-shake");
  };

  // Fun√ß√£o para verificar senha
  window.checkPin = function() {
      if(currentPin === correctPin) {
          // SENHA CORRETA:
          document.getElementById("loginScreen").style.display = "none";
          document.getElementById("appContainer").style.display = "block";
          initFirebase(); // S√≥ conecta no banco se a senha estiver certa
      } else {
          // SENHA ERRADA:
          const display = document.getElementById("pinDisplay");
          display.classList.add("error-shake"); // Treme a tela
          setTimeout(() => {
              currentPin = ""; // Limpa senha
              updateDisplay();
              display.classList.remove("error-shake");
          }, 500);
      }
  };

  function updateDisplay() {
      const display = document.getElementById("pinDisplay");
      // Substitui os n√∫meros por bolinhas para seguran√ßa (estilo senha de banco)
      display.innerText = "‚óè".repeat(currentPin.length);
  }

  // ------------------------------------------------------------------
  // PARTE 2: FIREBASE E L√ìGICA DO JOGO
  // ------------------------------------------------------------------
  
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

  // Fun√ß√£o que inicia o sistema ap√≥s login
  window.initFirebase = function() {
      document.getElementById("statusMsg").innerText = "Conectando ao banco de dados...";

      // --- SUAS CREDENCIAIS CONFIGURADAS ---
      const firebaseConfig = {
        apiKey: "AIzaSyDnTgThcU_lVdXASbg9ufMeUEE_x2uaYfQ",
        authDomain: "sontak-arise.firebaseapp.com",
        databaseURL: "https://sontak-arise-default-rtdb.firebaseio.com",
        projectId: "sontak-arise",
        storageBucket: "sontak-arise.firebasestorage.app",
        messagingSenderId: "165204128476",
        appId: "1:165204128476:web:8ed10f60587bcecad47a19"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const userRef = ref(db, 'usuarios/vitor'); // Pasta onde salva seus dados

      // Torna a refer√™ncia acess√≠vel globalmente
      window.userRef = userRef; 
      
      // OUVINTE EM TEMPO REAL: Se mudar no banco, muda na tela
      onValue(userRef, (snapshot) => {
          const data = snapshot.val();
          if (data) {
              updateUI(data.level, data.currentXP);
              document.getElementById("statusMsg").innerText = "SISTEMA ONLINE";
              document.getElementById("statusMsg").style.color = "#03dac6";
          } else {
              // Primeira vez usando? Cria n√≠vel 1
              set(userRef, { level: 1, currentXP: 0 });
          }
      });
  }

  // L√≥gica Matem√°tica (Cada n√≠vel √© 10% mais dif√≠cil que o anterior)
  function getXpForNextLevel(level) {
      return Math.floor(100 * Math.pow(1.1, level - 1));
  }

  // Fun√ß√£o do Bot√£o de Adicionar XP
  window.addXP = async function() {
      const input = document.getElementById("xpInput");
      const xpAmount = parseInt(input.value);
      
      if (!xpAmount) return; // Se estiver vazio, n√£o faz nada

      document.getElementById("statusMsg").innerText = "Salvando progresso...";
      
      // Pega dados atuais do servidor
      const snapshot = await get(window.userRef);
      let data = snapshot.exists() ? snapshot.val() : { level: 1, currentXP: 0 };
      
      let newXP = data.currentXP + xpAmount;
      let currentLevel = data.level;
      let xpNeeded = getXpForNextLevel(currentLevel);
      let leveledUp = false;

      // Loop de Level Up (caso ganhe XP suficiente para subir v√°rios n√≠veis)
      while (newXP >= xpNeeded) {
          newXP -= xpNeeded;
          currentLevel++;
          xpNeeded = getXpForNextLevel(currentLevel);
          leveledUp = true;
      }

      if (leveledUp) {
          alert(`üéâ N√çVEL SUPERADO! Bem-vindo ao N√≠vel ${currentLevel}!`);
      }

      // Envia atualiza√ß√£o para a nuvem
      await set(window.userRef, { 
          level: currentLevel, 
          currentXP: newXP 
      });

      input.value = ""; // Limpa campo
  }

  // Atualiza a barra visual e textos
  function updateUI(level, xp) {
      const xpNeeded = getXpForNextLevel(level);
      const percentage = Math.min((xp / xpNeeded) * 100, 100);

      document.getElementById("levelDisplay").innerText = level;
      document.getElementById("xpDisplay").innerText = xp;
      document.getElementById("nextLevelDisplay").innerText = xpNeeded;
      document.getElementById("xpBar").style.width = percentage + "%";
  }
</script>

</body>
</html>
